#!/command/with-contenv bashio
# ==============================================================================
# Home Assistant Community Add-on: InvoiceNinja
# # Start the original docker-entrypoint and supervisord under s6
# ==============================================================================

bashio::log.info "Copying env vars..."

# Set environment variables
export IS_DOCKER=true
export APP_ENV=production
export LOG=errorlog
export SNAPPDF_EXECUTABLE_PATH=/usr/bin/chromium-browser
export APP_ENV=$(bashio::config 'app_env')
export APP_DEBUG=$(bashio::config 'app_debug')
export APP_URL=$(bashio::config 'app_url')
export APP_KEY=$(bashio::config 'app_key')
export APP_CIPHER=$(bashio::config 'app_cipher')
export DB_TYPE=$(bashio::config 'db_type')
export DB_STRICT=$(bashio::config 'db_strict')
export DB_HOST=$(bashio::config 'db_host')
export DB_DATABASE=$(bashio::config 'db_database')
export DB_USERNAME=$(bashio::config 'db_username')
export DB_PASSWORD=$(bashio::config 'db_password')

# Set the working directory
cd /var/www/app || exit 1

# Log the values for debugging
bashio::log.info "Starting Invoice Ninja with APP_URL=${APP_URL}"
bashio::log.info "Database host: ${DB_HOST}"

bashio::log.info "Listing files in /var/www/app..."
ls -la /var/www/app

exec /usr/local/bin/docker-entrypoint supervisord -n
